<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Vòng Quay May Mắn (VIP Only)</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f0f0f0; }
        .wheel-container { margin: 20px auto; position: relative; width: 500px; height: 500px; }
        canvas { width: 100%; height: 100%; transform: rotate(-90deg); transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1); }
        #spinBtn {
            margin-top: 20px; padding: 15px 40px; font-size: 20px; cursor: pointer;
            background-color: #ff5722; color: white; border: none; border-radius: 5px; font-weight: bold;
        }
        #spinBtn:disabled { background-color: #ccc; cursor: not-allowed; }
        #result { margin-top: 20px; font-size: 24px; font-weight: bold; color: #333; height: 30px;}
        .arrow {
            position: absolute; top: 50%; right: -30px; transform: translateY(-50%);
            width: 0; height: 0; border-top: 15px solid transparent; border-bottom: 15px solid transparent; border-right: 30px solid red;
        }
    </style>
</head>
<body>

    <h1>Vòng Quay May Mắn</h1>
    <div class="wheel-container">
        <canvas id="wheel" width="500" height="500"></canvas>
        <div class="arrow" style="right: -20px; border-right: 40px solid red; border-top: 20px solid transparent; border-bottom: 20px solid transparent;"></div>
    </div>
    <div id="result"></div>
    <button id="spinBtn" onclick="spin()">QUAY NGAY</button>

<script>
    // 1. Danh sách hiển thị trên vòng quay (để làm màu)
    const allNames = [
        "Anh", "G bảo", "C Bảo", "Chiến", "Chương", "Đại", "Hiếu", "Hoàng", "Hưng", "Huy",
        "N Khang", "T Khang", "Khoa", "Lộc", "Q Minh", "T Minh", "Nghĩa", "Nhân", "Phú", "Quỳnh",
        "Thắng", "Phương", "Thiện", "Thọ", "Tín", "Tình"
    ];

    // 2. Danh sách 5 người ĐƯỢC CHỌN (Chỉ những người này mới có quà)
    const targetNames = ["Chiến", "G bảo", "Chương",];
    
    // Tạo một danh sách tạm để dùng cho 5 lần quay đầu tiên (để đảm bảo không trùng nhau)
    let firstBatch = [...targetNames]; 

    const colors = ['#FFCDD2', '#F8BBD0', '#E1BEE7', '#D1C4E9', '#C5CAE9', '#BBDEFB', '#B3E5FC', '#B2EBF2', '#B2DFDB', '#C8E6C9', 
                    '#DCEDC8', '#F0F4C3', '#FFF9C4', '#FFECB3', '#FFE0B2', '#FFCCBC', '#D7CCC8', '#F5F5F5', '#CFD8DC', '#ff8a80',
                    '#ff80ab', '#ea80fc', '#b388ff', '#8c9eff', '#82b1ff', '#80d8ff'];

    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const size = 500;
    const center = size / 2;
    const radius = size / 2;
    const step = 2 * Math.PI / allNames.length;
    let currentRotation = 0;

    function drawWheel() {
        for (let i = 0; i < allNames.length; i++) {
            ctx.beginPath();
            ctx.moveTo(center, center);
            ctx.arc(center, center, radius, i * step, (i + 1) * step);
            ctx.fillStyle = colors[i % colors.length];
            ctx.fill();
            ctx.stroke();
            ctx.save();
            ctx.translate(center, center);
            ctx.rotate(i * step + step / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "#000";
            ctx.font = "bold 14px Arial";
            ctx.fillText(allNames[i], radius - 10, 5);
            ctx.restore();
        }
    }
    drawWheel();

    let isSpinning = false;

    function spin() {
        if (isSpinning) return;
        isSpinning = true;
        document.getElementById('spinBtn').disabled = true;
        document.getElementById('result').innerText = "Đang quay...";

        let selectedName;

        // --- LOGIC GIAN LẬN MỚI ---
        if (firstBatch.length > 0) {
            // TRƯỜNG HỢP 1: 5 Lần đầu tiên
            // Lấy ngẫu nhiên 1 người trong danh sách VIP và XÓA khỏi danh sách tạm
            // Để đảm bảo 5 lần đầu sẽ ra đủ 5 người này.
            const idx = Math.floor(Math.random() * firstBatch.length);
            selectedName = firstBatch[idx];
            firstBatch.splice(idx, 1);
        } else {
            // TRƯỜNG HỢP 2: Từ lần thứ 6 trở đi
            // Vẫn chỉ lấy ngẫu nhiên trong danh sách gốc targetNames
            // Các tên khác ngoài danh sách này sẽ không bao giờ được gọi.
            const idx = Math.floor(Math.random() * targetNames.length);
            selectedName = targetNames[idx];
        }
        // ---------------------------

        const targetIndex = allNames.indexOf(selectedName);
        const segmentAngle = 360 / allNames.length; 
        const extraSpins = 360 * 10; 
        const stopAngle = (360 - (targetIndex * segmentAngle) - (segmentAngle / 2));
        const totalRotation = currentRotation + extraSpins + stopAngle - (currentRotation % 360);

        canvas.style.transform = `rotate(${totalRotation}deg)`;
        currentRotation = totalRotation;

        setTimeout(() => {
            isSpinning = false;
            document.getElementById('spinBtn').disabled = false;
            document.getElementById('result').innerText = "Kết quả: " + selectedName;
        }, 5000);
    }
</script>

</body>
</html>
